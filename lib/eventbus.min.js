(function(a,b){if(typeof exports==="object"&&typeof module==="object"){module.exports=b()}else{if(typeof define==="function"&&define.amd){define("EventBus",[],b)}else{if(typeof exports==="object"){exports.EventBus=b()}else{a.EventBus=b()}}}})(this,function(){function d(k,j){k=k||[];var h={stop:function(i){this.isStopped=true;this.result=i}};for(var g in k){j(g,k[g],k,h);if(h.isStopped){break}}if(h.isStopped){return h.result}}function f(i,h,g){if(h>i.length){return[]}return[].slice.call(i,h==undefined?0:h,g==undefined?i.length:g)||[]}function b(i,k,g){if(typeof i=="string"||i instanceof Array){var h=i;if(typeof i=="string"){h=i.trim().split(e.DEFAULT.EVENT_TYPE_SPLIT_EXP)}if(h.length>1){var j=this;d(h,function(l,m){g[0]=m;k.apply(j,g)});return j}else{i=h[0]}}return i}var c=(function(){var g=1000;return function(){return ++g}})();var e={};e=function(){this.listeners={};this.regexListeners=[]};e.prototype={on:function(j,m,i){j=b.call(this,j,this.on,f(arguments));if(j==this){return this}var l=j instanceof RegExp;var h=l?j.toString():j;var g=f(arguments);if(e.DEFAULT.SHOW_LOG){console.log("on=>listener args is ",g)}var k={id:c(),scope:i||{},callback:m,args:g,regExp:j,eventType:h};if(!l){if(typeof this.listeners[h]!="undefined"){this.listeners[h].push(k)}else{this.listeners[h]=[k]}}else{this.regexListeners.push(k)}return this},once:function(k,l,j){var g=this;var h=function(m){l.apply(this,f(arguments));g.off(k,h,j)};var i=f(arguments);i[1]=h;return g.on.apply(g,i)},off:function(k,l,o){k=b.call(this,k,this.off,[undefined,l,o]);if(k==this){return this}var i=k instanceof RegExp;var h=i?k.toString():k;var m=[];if(typeof l=="object"){o=l;l=undefined}var j=l==undefined;var n=o==undefined;if(e.DEFAULT.SHOW_LOG){console.log("off=>off event type:",k," all callback:",j," all scope:",n)}function g(p){return(j?true:p.callback==l)&&(n?true:p.scope==o)}if(!i){if(typeof this.listeners[h]!="undefined"){if(!(j&&n)){d(this.listeners[h],function(p,q){if(!g(q)){m.push(q)}else{}})}this.listeners[h]=m}}else{d(this.regexListeners,function(p,q){if(!(q.eventType==h&&g(q))){m.push(q)}else{}});this.regexListeners=m}return this},redirect:function(h,l,m,k){if(arguments.length==1&&typeof h=="object"){var j=h;h=j.origin;l=j.endpoint;m=j.condition;k=j.processor}var g=this;if(h==undefined||l==undefined||h==l){return g}var i=this.redirectScope=this.redirectScope||{};k=typeof k=="function"?k:function(n){n.setEmitArgs(a.slice(arguments,1))};this.on(h,(function(q,r,o){if(r==undefined){r=function(){return true}}if(r instanceof RegExp){var p=r;r=function(s){return p.test(s.type)}}if(typeof r=="function"){var n=[];return function(u){var s=f(arguments);if(r.apply(i,s)){var t=typeof q=="function"?q.apply(i,s):q;if(n.indexOf(o)<0&&t!=u.type&&t!=undefined){n.push(o);if(typeof t=="string"){t=t.trim().split(e.DEFAULT.EVENT_TYPE_SPLIT_EXP)}if(!(t instanceof Array)){t=[t]}d(t,function(v,x){if(x!=u.type){var w=f([].concat(s),1);u.setEmitArgs=function(y){w=y};u.getEmitArgs=function(){return[].concat(w)};u.getOriginType=function(){return h};u.getEndpoint=function(){return x};k.apply(i,s);w=(w instanceof Array)?[""].concat(w):[].concat(s);w[0]=x;if(e.DEFAULT.SHOW_LOG){console.log("redirect=>redirect id:",u.id," origin:",h," ==> endpoint:",x)}g.emit.apply(g,w)}});n.pop()}else{if(e.DEFAULT.SHOW_LOG){console.log("redirect=>origin:",h.toString()," ==>endpoint:",q.toString()," redirect is looping! this event is lost.")}}}}}else{return function(s){if(e.DEFAULT.SHOW_LOG){console.log("redirect=>redirect condition must set function or RegExp!")}}}})(l,m,c()),i);return g},has:function(k,n,j){var m=k instanceof RegExp;var h=m?k.toString():k;var i=[].concat(this.listeners[h]);if(typeof n=="object"){j=n;n=undefined}if(i.length>0&&!m){var l=i.length;if(n===undefined&&j===undefined){return l>0}var g=d(i,function(o,q,r,p){if((j?q.scope==j:true)&&(n?q.callback==n:true)){p.stop(true)}});if(g){return true}}else{if(m){i=[].concat(this.regexListeners);var g=d(i,function(o,q,r,p){if(q.regExp.toString()==h&&(j?q.scope==j:true)&&(n?q.callback==n:true)){p.stop(true)}});if(g){return true}}}return false},emit:function(j){var g=f(arguments);j=b.call(this,j,this.emit,g);if(j==this){return this}var k={id:j+"#"+c(),type:j,target:g.length>1?g[1]:{}};g=[k].concat(f(arguments,1));var i=[].concat(typeof this.listeners[j]=="undefined"?[]:this.listeners[j]);function l(n){var m=false;k.stop=function(){m=true};k.getArg=function(o){if(k.args==undefined||!k.args instanceof Array||k.args.length-1<o){return undefined}return k.args[o]};d(n,function(o,s,q,p){if(s&&s.callback){var r=[].concat(g);if(e.DEFAULT.SHOW_LOG){console.log("emit=>event listener call arguments:",r)}k.args=[].concat(s.args);if(e.DEFAULT.SHOW_LOG){console.log("emit=>fire event listener:",s)}s.callback.apply(s.scope,r);if(m){p.stop()}}})}var h=[].concat(this.regexListeners);d(h,function(m,n){if(n.regExp.test(j)){i.push(n)}});l(i);return this},getEvents:function(){var l="";for(var h in this.listeners){var k=this.listeners[h].length;for(var g=0;g<k;g++){var j=this.listeners[h][g];l+=j.scope&&j.scope.className?j.scope.className:"anonymous";l+=" listen for '"+h+"'\n"}}d([].concat(this.regexListeners),function(i,m){l+=m.scope&&m.scope.className?m.scope.className:"anonymous";l+=" listen for '"+m.eventType+"'\n"});return l}};e.prototype.bind=e.prototype.addEventListener=e.prototype.on;e.prototype.unbind=e.prototype.removeEventListener=e.prototype.off;e.prototype.trigger=e.prototype.dispatch=e.prototype.emit;e.prototype.hasEventListener=e.prototype.has;var a=new e();a.slice=f;a.nextId=c;a.iterator=d;a.DEFAULT=e.DEFAULT={SHOW_LOG:false,EVENT_TYPE_SPLIT_EXP:/,|\s/};return a});