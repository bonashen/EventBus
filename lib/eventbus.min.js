(function(a,b){if(typeof exports==="object"&&typeof module==="object"){module.exports=b()}else{if(typeof define==="function"&&define.amd){define("EventBus",[],b)}else{if(typeof exports==="object"){exports.EventBus=b()}else{a.EventBus=b()}}}})(this,function(){function d(k,j){k=k||[];var h={stop:function(i){this.isStopped=true;this.result=i}};for(var g in k){j(g,k[g],k,h);if(h.isStopped){break}}if(h.isStopped){return h.result}}function f(i,h,g){if(h>i.length){return[]}return[].slice.call(i,h==undefined?0:h,g==undefined?i.length:g)||[]}function b(i,k,g){if(typeof i=="string"||i instanceof Array){var h=i;if(typeof i=="string"){h=i.trim().split(/\s|,/)}if(h.length>1){var j=this;d(h,function(l,m){g[0]=m;k.apply(j,g)});return j}else{i=h[0]}}return i}var c=(function(){var g=1000;return function(){return ++g}})();var e={};e=function(){this.listeners={};this.regexListeners=[]};e.prototype={on:function(j,m,i){j=b.call(this,j,this.on,f(arguments));if(j==this){return this}var l=j instanceof RegExp;var h=l?j.toString():j;var g=f(arguments);var k={id:c(),scope:i||{},callback:m,args:g,regExp:j,eventType:h};if(!l){if(typeof this.listeners[h]!="undefined"){this.listeners[h].push(k)}else{this.listeners[h]=[k]}}else{this.regexListeners.push(k)}return this},once:function(k,l,j){var g=this;var h=function(m){l.apply(this,f(arguments));g.off(k,h,j)};var i=f(arguments);i[1]=h;return g.on.apply(g,i)},off:function(k,l,o){k=b.call(this,k,this.off,[undefined,l,o]);if(k==this){return this}var i=k instanceof RegExp;var h=i?k.toString():k;var m=[];if(typeof l=="object"){o=l;l=undefined}var j=l==undefined;var n=o==undefined;function g(p){return(j?true:p.callback==l)&&(n?true:p.scope==o)}if(!i){if(typeof this.listeners[h]!="undefined"){if(!(j&&n)){d(this.listeners[h],function(p,q){if(!g(q)){m.push(q)}else{}})}this.listeners[h]=m}}else{d(this.regexListeners,function(p,q){if(!(q.eventType==h&&g(q))){m.push(q)}else{}});this.regexListeners=m}return this},redirect:function(h,j,k){var i=this.redirectScope=this.redirectScope||{};var g=this;if(h==j){return g}this.on(h,(function(o,p,m){if(p==undefined){p=function(){return true}}if(p instanceof RegExp){var n=p;p=function(q){return n.test(q.type)}}if(typeof p=="function"){var l=[];return function(r){var q=f(arguments);if(p.apply(this,q)){q[0]=typeof o=="function"?o.apply(this,q):o;if(l.indexOf(m)<0&&q[0]!=r.type){l.push(m);g.emit.apply(g,q);l.pop()}else{console.log("==>origin:",h.toString()," ==>endpoint:",o.toString()," redirect is looping! this event is lost.")}}}}else{return function(q){console.log("redirect condition must set function or RegExp!")}}})(j,k,c()),i);return g},has:function(k,n,j){var m=k instanceof RegExp;var h=m?k.toString():k;var i=[].concat(this.listeners[h]);if(typeof n=="object"){j=n;n=undefined}if(i.length>0&&!m){var l=i.length;if(n===undefined&&j===undefined){return l>0}var g=d(i,function(o,q,r,p){if((j?q.scope==j:true)&&(n?q.callback==n:true)){p.stop(true)}});if(g){return true}}else{if(m){i=[].concat(this.regexListeners);var g=d(i,function(o,q,r,p){if(q.regExp.toString()==h&&(j?q.scope==j:true)&&(n?q.callback==n:true)){p.stop(true)}});if(g){return true}}}return false},emit:function(j){var g=f(arguments);j=b.call(this,j,this.emit,g);if(j==this){return this}var k={type:j,target:g.length>1?g[1]:{}};g=[k].concat(f(arguments,1));var i=[].concat(typeof this.listeners[j]=="undefined"?[]:this.listeners[j]);function l(n){var m=false;k.stop=function(){m=true};k.getArg=function(o){if(k.args==undefined||!k.args instanceof Array||k.args.length-1<o){return undefined}return k.args[o]};d(n,function(o,s,q,p){if(s&&s.callback){var r=[].concat(g);k.args=[].concat(s.args);s.callback.apply(s.scope,r);if(m){p.stop()}}})}var h=[].concat(this.regexListeners);d(h,function(m,n){if(n.regExp.test(j)){i.push(n)}});l(i);return this},getEvents:function(){var l="";for(var h in this.listeners){var k=this.listeners[h].length;for(var g=0;g<k;g++){var j=this.listeners[h][g];l+=j.scope&&j.scope.className?j.scope.className:"anonymous";l+=" listen for '"+h+"'\n"}}d([].concat(this.regexListeners),function(i,m){l+=m.scope&&m.scope.className?m.scope.className:"anonymous";l+=" listen for '"+m.eventType+"'\n"});return l}};e.prototype.bind=e.prototype.addEventListener=e.prototype.on;e.prototype.unbind=e.prototype.removeEventListener=e.prototype.off;e.prototype.trigger=e.prototype.dispatch=e.prototype.emit;e.prototype.hasEventListener=e.prototype.has;var a=new e();return a});